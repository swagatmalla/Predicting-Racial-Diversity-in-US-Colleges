---
title: "Predicting Diversity in Higher Education Institutions"
author: "Zoe Plechaty, Maya Patty, Swagat Malla"
output: pdf_document
header-includes:
   - \usepackage{dcolumn}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(mosaic)
library(infer)
library(ggResidpanel)
library(Stat2Data)
library(ROCR)
library(ggformula)   # for geom_lm()
library(car)         # for vif()
library(tidyverse)# ALWAYS load last
library(stargazer)
```

```{r, echo=FALSE, include = FALSE}
#use this plot in main body
collegeAdmission <- read_csv("~/Stats 272 F22/Project/Group 7A: Swagat, Zoe, Maya/cleanedDf.csv")
collegeAdmission <- collegeAdmission %>% 
  mutate(high_diversity = ifelse(perc_POC > 20, 1, 0)) %>% 
  mutate(tuition10000 = tuitionFees2013_14/10000) %>% 
  mutate(diverse_yes = ifelse(high_diversity == 1, "YES", "NO"))

collegeAdmission2 <- collegeAdmission %>% 
  filter(HBCUYes == 0)

wrapper <- function(label, dev_width = dev.size("in")[1], dev_scaler = 12)  {   
  paste(strwrap(label, dev_width * dev_scaler), collapse = "\n") 
}
```



### Introduction 
 Over the last decade statistics have demonstrated that diversity in higher education has been increasing. According to The U.S. Census Bureau data that shows progress for educational attainment across various ethnic groups between 2010 and 2019. As of 2021, the demographics for high school graduates enrolled in college was 61% for white people, 85.9% for Asians, 61.2% for African Americans, and 58.6% for Hispanic graduates (U.S Bureau of Labor Statistics). These differences could be due to the many factors that contribute to a student’s decision to where and if they will be attending college. In a study done by the Education Advisory Board (EAB) in 2016, out of the students who were denied their first choice college, 40% of them noted it was due to cost related issues. The next highest group of students who denied their first choice was due to the geographic area that their institution was located. However, these factors of financial issues and location may vary between students of minority groups and white students. Many groups of people struggle with socioeconomic disadvantages and little access to resources that provide pathways into higher education. There is a huge importance in higher education for people of minority groups and can benefit and broaden the individual’s worldview immensely, not only for those select students but every student at institutions across the United States (UCDA). 
 
The primary motivation of our research is to investigate and detect patterns in institutional characteristics or factors that may affect and/or increase diversity in higher education. Our dataset brings in variables that look at the number of undergraduate freshmen receiving financial aid and Pell Grants from each institution, the control of each institution (private and public), tuition costs, geographic location etc. With our dataset and the variables listed above, our goal is to create models with multiple linear and logistic regression to predict the diversity of higher education institutions, at a given cutoff point that is deemed a diversity goal. Our primary research question is: What institutional characteristics are the most significant predictors of racial diversity in enrolled undergraduates? Based on our prior research we hypothesize that higher education institutions that are more diverse will be those that are more accessible to people from a variety of backgrounds such as a public school with lower tuition and in a more urban area.


## Materials and Methods 
Our dataset contains different statistics related to higher education institutions (in the U.S.) in the year 2013-14. It has information such as the racial composition, the tuition fees, and percentages of students receiving different kinds of financial aids. In addition to that, it also has information related to the institution's location, standardized test scores and  number of applicants and acceptances. It has data for both undergraduate and graduate level of study, but we have focused our study on undergraduate students. The dataset was made available on Kaggle by a user named Samson Qian. We were not able to find much documentation (or a similar dataset) elsewhere, but the data and variables in the dataset seem to fit our goals and purposes, which was to determine the predictors of diversity in colleges. As per the data collection method, we believe it was scraped off the web by the user themselves. 
  
Of all the available variables in the dataset, we focused on the tuition and fees in 2013-14 (in US Dollars), control of the institution (public vs private), its geographic region in the US, percentage of freshmen receiving Pell Grant, and the degree of urbanization of its location. A more exhaustive list of all variables (and their definitions) that we considered is included in the appendix.

  To begin with, we observed that there were quite a bit of rows with missing values, which was perhaps due to colleges not reporting certain statistics such as standardized test scores. This impacted our decision to discard or use certain variables. We decided to drop rows where there were missing values for the variables included in our models as they indicated incompleteness in the dataset, and we did so by choosing our variables in a way that would not cause a huge loss of data.This gave us a total of 1491 institutions to work with. Furthermore, we decided to drop all the Historically Black Colleges and Universities since such institutions have higher numbers of POC by design.This reduced the number of observations down to 1410. 

 The response variable  `perc_Poc` (percentage of people of color) was computed using the percentages of each race and total undergraduate enrollment. We computed summary statistics (means, standard deviation, and median) for our quantitative variables to better understand our data. We also computed proportion tables for our qualitative variables. We adjusted the dataset according to align it more to our objective. For instance, the variable `degreeUrbanization` in the original dataset had twelve levels: four main groups (City, Town, Rural, Suburb) and subgroups for each group. This variable was condensed to the four main groups for easier interpretation in the model. Similarly for `geographicRegion`, we removed the state initials from each level for shorter level names. The tuition variable was computed in thousands and ten thousands of dollars for a more meaningful interpretation of the coefficient. 
 
  We computed a correlation matrix for all the selected quantitative variables and picked the ones which had comparatively larger correlation values to build our initial models using linear regression. We added more categorical and quantitative variables and performed hypothesis testing using t-statistic, also observing the adjusted R-squared to assess the effectiveness of the model. Nested F-tests helped us determine whether the added variable was statistically significant. To evaluate the assumptions of linear regression, we used  the QQ-plot and residual plot, which showed violation of the equal variance and normality assumptions. To remedy this, we opted for logistic regression to estimate the probability that a given institution has high diversity.To determine this (high diversity or not), we used the median percentage of POC as a threshold. Finally, we assessed the fit for logistic regression using empirical logits, ROC curve, confusion table and C-statistic. 

### Results

The percentage of POC students in undergraduate populations in the US has a mean of 25.77% (+/- 19.3%) and a median of 20%. The mean tuition of included institutions is \$23,330 with a standard deviation of $12,830, and it had a correlation of -0.223 with percentage POC students (Figure 1). The colleges in the dataset are grouped as either public or private, 63% are public and 37% are private. This difference may affect the diversity of higher education institutions as private institutions tend to have a lower percentage of POC students in the undergraduate student body (Figure 2). Additionally, of all institutions included 5.4% are HBCU, historically black colleges or universities. 

```{r, echo=FALSE}
collegeAdmission2 %>%
  ggplot(mapping = aes(y = perc_POC, x = tuition1000Dollar, color = factor(control)))+ 
  geom_point(alpha = 0.5)+
  geom_smooth(method = 'lm', se = FALSE) +
  labs(x = "Tuition ($1000s)", y = "Percentage of Undergraduate Student Body POC (%)", color = "Instititional Control", caption = wrapper("Figure 1: Relationshipship between the percentage of POC students in undergraduate populations and tuition in thousands of dollars for private (red) and public (blue) institutions.")) +
   theme(plot.caption = element_text(hjust=0))
```

```{r, echo=FALSE, "Percentage POC by Control"}
collegeAdmission2 %>%
  ggplot(aes(x = control, y = perc_POC))+ 
  geom_boxplot(varwidth = TRUE) +
  labs(x = "Institutional Control", y = "Percentage of Undergraduate Population POC (%)", color ="Institutional Control" , caption = wrapper("Figure 2: The mean percentage of POC students in the undergraduate population for institutions which are Private and Publically controlled universities. ")) +
   theme(plot.caption = element_text(hjust=0))
```

Lastly, the boxplot of percentage of POC students by geographic region supported its inclusion in our preliminary model because the Far West and Southwest regions had higher percentages than all others and there were differences between all (Figure 3). 9.5% of the included institutions are in the Far West and 7.2% are in the Southwest. In contrast, the Great Lakes Region accounted for 16% and the Mid East 19.5% of all schools. Further, the degree of urbanization of the area each institution is located varied  with 46.1% in a city location, 24.1% in a suburb, and 23% town, and 6.7% rural. 

```{r, echo=FALSE}
## include in main body
collegeAdmission2 %>%
  ggplot(mapping = aes(y = perc_POC, x = geographicRegion))+ 
  geom_boxplot(varwidth = TRUE, alpha = 0.5) +
  labs(x = "Geographic Region", y = "Percentage of Undergraduate Student Body POC (%)", caption = wrapper("Figure 3: The mean percentages of POC students in udergraduate population for US institutions in each geographic region.")) +
  theme(plot.caption = element_text(hjust=0))
```
Model 1 is a linear regression model predicting the percentage of POC students in the student population by tuition in 1000s of dollars, the percentage of students receiving Pell Grants, HBCU, the control of the institution, Geographic Region, and Degree of Urbanization. The linear model does a fairly good job of describing patterns in the data, accounting for 46.4% of variation in the data (R-squared = 0.464). In addition, all coefficients are significant predictors of the percentage for POC students (p<0.05) (Table 1). According to the model coefficients, a tuition increase in $1000 results in an increase of 0.39% of diversity (t = 6.4, p<0.05), for a private institution in the Far West in a city after controlling for Pell Grants. For the same baseline institution, but controlling for tuition, an increase in the percentage of students with Pell Grants by 1% increased diversity by 0.6%  (t=22.45, p<0.05). Being a public university (control of institution being public), for a city school in the Far West controlling for Pell Grants and tuition, increased the percentage of POC students by 8.73% (t = 6.23, p<0.05). The geographic regions, besides Southwest, had negative coefficients, indicating that diversity decreases in these regions compared to the Far West for schools with the same control and urbanization. There is a 3.41% increase in percentage of POC students for institutions in the Southwest compared to the Far West, holding all else constant (t =1.99, p < 0.05). The residual of this model showed violations of the equally variance assumption, and there were a large number of outliers which the model failed to predict well. Therefore, a logistic regression was used next. 

Model 2 is a logistic regression model using only the tuition in \$10000 and the percentage of students receiving Pell Grants and does a good job of predicting the diversity of an institution. This model was fit using a threshold of 20% POC students as the criteria for high diversity. After controlling for Pell Grants, an increase in tuition of $10000 increases the odds of a school having high diversity by 11.1% (z =  2.107, p<0.05) (Table 1). After controlling for tuition, an increase in students receiving Pell Grants by 1% increases the odds of a school having high diversity by 4.1% (z =9.91, p<0.05) (Table 1). 

Model 3 was also a logistic regression model which predicted diversity using all of the same predictor variables as the linear regression. For the baseline institution, which is a private school in a city located in the Far West region, a tuition increase of $10000 results in an increase of the odds of a school having high diversity by the factor of 1.83 or 83% (z= 5.05, p<0.05) (Table 1), after controlling for Pell Grants. Additionally, for the same baseline school but controlling for tuition, an increase in Pell Grants by 1% results in a 7.1% increase in the odds of a school having high diversity (z = 11.41, p<0.05) (Figure 4)(Table 1). The control of the institution has a large effect as a public institution has 3.71 times larger odds of having high diversity compared to a private school (z = 4.75, p<0.05)(Table 1), for the baseline school and controlling for other variables. When adding in Geographic Regions as predictors, all regions besides the Southwest predict a lower odds of a school having high diversity, as compared to a baseline school located in the Far West. A school in the Southwest has 2.5 times larger odds of having high diversity than a school in the Far West (z =2.312, p<0.05)(Table 1). The degree of urbanization being rural or town decreases the odds of a school having high diversity by 0.14 times and 0.24 times respectively compared to a city. The location of a school in a suburb decreases the odds of an institution being high diversity by 0.997 times and this is an insignificant predictor (z = -0.021, p > 0.05) (Table 1). 
```{r, include=FALSE}
#model with just tuition and pell grants
modelTuition_PellGrants = glm(high_diversity ~ tuition10000 + perc_FreshmenPellGrants, family = binomial(link="logit"), data = collegeAdmission2)
summary(modelTuition_PellGrants)

#just Pell Grants
modelPellGrants = glm(high_diversity ~ perc_FreshmenPellGrants, family = binomial(link="logit"), data = collegeAdmission2)
summary(modelPellGrants)

#just Tuition
modelTuition = glm(high_diversity ~ tuition10000, family = binomial(link="logit"), data = collegeAdmission2)
summary(modelTuition)

anova(modelPellGrants, modelTuition_PellGrants, test = "Chisq") 
```

```{r,include=FALSE}
#prediction for probability curve 

predict_atTuition <- tibble(tuition10000 = seq(from = 0.27, to = 5, length = 1000))

predict_atPellGrant <- tibble(perc_FreshmenPellGrants = seq(from = 0, to = 100, length = 1000))


prob_highdiversity <- unname(predict(modelPellGrants, new = predict_atPellGrant, type="response")) #for Pell grants

prob_highdiversity2 <- unname(predict(modelTuition, new = predict_atTuition, type="response")) # for Tuition

modeled_p <- tibble(predict_atPellGrant, prob_highdiversity = prob_highdiversity)
modeled_p2 <- tibble(predict_atTuition, prob_highdiversity = prob_highdiversity2)
```

```{r, echo=FALSE, "Figure4"}
#probability curve for pell grants
ggplot() +
geom_point(data = collegeAdmission2, aes(x = perc_FreshmenPellGrants, y = high_diversity), alpha = 0.2) +
geom_line(data = modeled_p, aes(x = perc_FreshmenPellGrants, y = prob_highdiversity), color="red") +
  labs(x = "Percentage of Freshmen Recieving Pell Grants", y = "Probability of High Diversity", caption = wrapper("Figure 4: Probability curve of an institution having high diversity (greater than 20% POC students) as predicted by the percentage of freshmen students recieving Pell Grants."))
```
To analyze the success of the final logistic model, we generated a confusion table to determine the overall success rate of the model’s predictions. The number of correct predictions was 1038, which produces an overall success rate of 73.61%. The sensitivity of the model, proportion of correct high diversity predictions was 0.684 and the specificity of the model, proportion of cases correctly identified as not diverse, was 0.783. These values, when plotted, reveal the ROC curve for this logistic regression model, and indicate that the model is doing well at predicting the diversity of various institutions (AUC = 0.821).
```{r, include = FALSE}
model1 <-lm(perc_POC ~ tuition1000Dollar + controlPublic + geographicRegion_factor +degreeUrbanization+ perc_FreshmenPellGrants, data = collegeAdmission2) 


model2 = glm(high_diversity ~ tuition10000 + perc_FreshmenPellGrants, family = binomial(link="logit"), data = collegeAdmission2)

model3<- glm(high_diversity ~ tuition10000 + controlPublic + geographicRegion_factor + perc_FreshmenPellGrants + degreeUrbanization_factor, family = binomial(link="logit"),data = collegeAdmission2)
```

```{r, "Table of Coefficients", echo = FALSE, results = 'asis'}
stargazer(model1, model2, model3, title = "Model Coefficients", type = 'latex', align = TRUE, no.space = TRUE)
```


## Discussion 
Model 1 did a fair job predicting the diversity of higher educational institutions (Table 1), but Model 3, a logistic regression model which predicts if an institution is over a certain diversity threshold, is the better model. Model 3 indicates that public schools have an increased probability of being more diverse when compared to private schools (Table 1)(Figure 2). Being located outside of the Far West, except the Southwest, decreases the probability of high diversity, as does moving out of cities and suburbs in terms of urbanization effects. As stated in the introduction, location was the second largest factor in a student’s college decision based on the survey from the Education Advisory Board, so we are not surprised to find that diversity in higher education is significantly variable across regions (Figure 3). Financially, increased tuition also increased the odds of an institution being predicted as diverse (Table 1), this was contrary to our expected results because higher tuition cost makes schools more unavailable to a wider population. However, the fact that increased reception of Pell Grants by students led to an increase in odds of being high in diversity (Figure 4) suggests that access to other forms of financial aid may be offsetting the detrimental effects of higher tuition on diversifying a student body. We found financial factors to be significant when predicting diversity in institutions which agrees with previous findings that cost related issues play a role in where minority students enroll in college (EAB). 

Overall, these results present mixed support to the hypothesis that higher education institutions more accessible to people from a variety of backgrounds have higher diversity. For example, institutions in cities have higher diversity, potentially because cities have higher populations and amounts of diversity than rural areas and this is reflected in colleges too. This supports the accessibility hypothesis because a school located in a populous area likely is more accessible to many and reflective of that diversity. Furthermore, the increased odds of diversity from a greater percentage of Pell Grant recipients supports the conclusion that financial support for making higher education accessible is associated with higher diversity. We have evidence that certain geographic regions are associated with higher diversity than others, however this does not necessarily mean that the Far West and Mid East are more accessible than the Great Lakes region. These differences may also be due to differences in the diversity of the population in those regions. Overall, we have some evidence that supports our hypothesis of accessibility increasing higher education diversity, but there is also support for previous findings that geographic location and cost factors are significant institution characteristic minority students consider in their college decision making process. 

These models are generated from an observational study so we can conclude significant associations in predictors to increasing odds of high diversity, but we cannot conclude causation. The sample is representative of schools from all regions of the US, including both public and private schools, so the results are generalizable across most parts of the United States and most schools. It is hard to generalize conclusions about college enrollment from these models because there are a large number of factors which go into a student’s decision to attend a certain university or not, many that a college itself does not have control over. Confounding variables like this may include proximity to home or campus culture, which are difficult to measure in a large national scale sample. In addition, there is the confounding variable that socio-economic status for enrolled students is not included, and this may also be a confounding variable because it factors into how financially accessible a school is to a veteran person. 

Over the course of our project we experienced some limitations within our research. Beginning with the dataset, our data was from the 2013-2014 academic year, being nearly 10 years old. There were also many interactions we could not account for. One would be going beyond public and private institutions and taking account for the size of the student body at each institution. Another interaction we were unable to investigate was the relationship between degree of urbanization and geographic region, and also Pell Grants and tuition. Another limitation was that there was a significant amount of missing data, which discouraged us from using certain variables (the standardized test scores for instance) in our models. A more complete dataset with more documentation would have helped us be more confident about the accuracy of the data and way the data was collected in the first place. 

Our analysis is strong in the flexibility in lending itself to different models as it moved between linear and logistic. The data set was quite sporadic and our analysis found ways to address violations of the linear regression assumptions by transitioning to logistic. Our analysis is weak however in setting the diversity threshold. We used the median percentage of POC students as the threshold for high and low diversity distinctions, but this could be improved by finding a diversity goal higher education institutions use as  a benchmark for diversity. This information does not seem to be readily accessible, but it may be useful to define going forward.

Based on our limitations, it would be beneficial to consider going more in depth with variables that account for the size of the school and possibly looking at individual states rather than regions. These items may also provide better insight for variables like Pell Grants and tuition of each institution. For future research, these may produce more information regarding diversity in higher education.

## Peer Review Feedback
The feedback from our peer reviewers emphasized expanding the introduction and including outside literature in the discussion section. They also recommended working on the transitions in the methods section, referring to figures in the discussion section, adding a table of coefficients to the paper, and naming the models more explicitly to keep track of them during the results and discussion section. In response to this we added more content to the introduction and a reference to these sources in the discussion section. We also worked on the transitions of the methods section. Additionally, we created a table for comparing the models (using the stargazer package) to be included and named our models. Lastly, we added references to tables and figures throughout the paper. 


# Article Citations (APA)

Bennett, C., Evans, B., & Marsicano, C. (2021). Taken for Granted? Effects of Loan-Reduction Initiatives on Student Borrowing, Admission Metrics, and Campus Diversity. Research in Higher Education, 62(5), 569–599. https://doi.org/10.1007/s11162-020-09615-7

61.8 percent of recent high school graduates enrolled in college in October 2021: The Economics Daily: U.S. Bureau of Labor Statistics. (n.d.). Retrieved December 8, 2022, from https://www.bls.gov/opub/ted/2022/61-8-percent-of-recent-high-school-graduates-enrolled-in-college-in-october-2021.htm

Diversity in higher education: Statistics, gaps, and resources - 08-06-2021 : ucda contact: courtesy of bradley university. (n.d.). Courtesy of Bradley University. Retrieved December 8, 2022, from https://www.ucda.com/journal/diversity-in-higher-education/

Hurtado, S., Inkelas, K. K., Briggs, C., & Rhee, B.-S. (1997). Differences in College Access and Choice Among Racial/Ethnic Groups: Identifying Continuing Barriers. Research in Higher Education, 38(1), 43–75. https://doi.org/10.1023/A:1024948728792

Why do students decline their dream schools? | EAB. (2017, March 23). https://eab.com/insights/blogs/enrollment/why-do-students-decline-their-dream-schools/

### Annotated Appendix 
# Variable Definitions:
- perc_Poc = the percentage of enrolled undergraduates who are Persons of Color
- undergradEnrollment = total undergreaduate enrollment of the institution
- freshmenFinAidPercent = the percentage of freshmen receiving any form of financial aid
- tuitionFees2013_14 = total tution and fees for the 2013-2014 academic year in dollars($)
- geographicRegion = the geographic region the institution is located, seven levels: Southeast, Southwest, Northeast, Northwest, Rocky Mountain, Midwest, 
- control = the control of the institution as either private not-for-profit or public
- HBCU = Yes or No of whether the institution is a historically black college or university 
- Tribal College = Yes or No of whether the institution is a tribal college 
- degreeUrbanization = the degree of urbanization of the location of the institution: City, Suburb, Town or Rural
- perc_Women = the percentrage of the undergradiate student body which is women
- perc_FreshmenPellGrants = the percentage of freshmen students recieving pell grants at an institution
- perc_FreshmenIntsGrantAid = the percentage of freshmen recieving financial aid in the form of grants from the institution
- tuition1000Dollar = the tuition and fees for the 2013-2014 academic school year in thousands of dollars ($)
- controlPublic = the control of the institution as a binary, 1 = Public, 0 = private
- HBCUYes = HBCU as a binary variable, 1 = HBCU, 0 = Not HBCU
- geographicRegion_factor = converting `geographicRegion` into a factor variable
- degreeUrbanization_factor = converting `degreeUrbanization` into a factor vairable

# R Code Used to Make Final Dataset

```{r}
## reread in original DATA
collegeAdmission <- read_csv("~/Stats 272 F22/Project/Group 7A: Swagat, Zoe, Maya/CollegeAdmissions.csv")
#Getting the right vars and renaming
cleanedDf <- collegeAdmission[c(1, 33, 38, 41, 42, 43, 44, 49, 97, 64:72, 74, 100, 103)] # 8, 10, 12)] 
cleanedDf <- cleanedDf[c(1,8,9, 2:7, 10:21)]


cleanedDf <- rename(cleanedDf, 
       undergradEnrollment = `Undergraduate enrollment`,
       freshmenFinAidPercent = `Percent of freshmen receiving any financial aid` ,
        tuitionFees2013_14 = `Tuition and fees, 2013-14`, 
       geographicRegion = `Geographic region`, 
       control = `Control of institution`, 
       HBCU = `Historically Black College or University`, 
       degreeUrbanization = `Degree of urbanization (Urban-centric locale)`, 
       perc_AmericanIndianAlaskaNative = `Percent of undergraduate enrollment that are American Indian or Alaska Native`, 
       perc_Asian = `Percent of undergraduate enrollment that are Asian`, 
       perc_BlackAfricanAmerican = `Percent of undergraduate enrollment that are Black or African American`, 
       perc_HispanicLatino = `Percent of undergraduate enrollment that are Hispanic/Latino`, 
       perc_NativeHawaiian_OtherPacificIslander = `Percent of undergraduate enrollment that are Native Hawaiian or Other Pacific Islander` , 
       perc_White = `Percent of undergraduate enrollment that are White` , 
       perc_MutiRacial = `Percent of undergraduate enrollment that are two or more races` , 
       perc_RaceUnknown = `Percent of undergraduate enrollment that are Race/ethnicity unknown` , 
       perc_NonresidentAlien = `Percent of undergraduate enrollment that are Nonresident Alien`, 
       perc_Women = `Percent of undergraduate enrollment that are women`,
       perc_FreshmenPellGrants = `Percent of freshmen receiving Pell grants`, 
       perc_FreshmenInstGrantAid = `Percent of freshmen receiving institutional grant aid`, 
     #  SATMath75 = `SAT Math 75th percentile score`, 
      # SATReading75 = `SAT Critical Reading 75th percentile score`, 
       #SATWriting75 = `SAT Writing 75th percentile score`
       )

```

```{r}
#mutating the variables we need
cleanedDf <-cleanedDf %>%
  mutate(
    numPOC = 
      (perc_AmericanIndianAlaskaNative/100 + 
         perc_Asian/100 + 
         perc_BlackAfricanAmerican/100 + 
         perc_HispanicLatino/100 + 
         perc_NativeHawaiian_OtherPacificIslander/100 ) * undergradEnrollment, 
    perc_POC = 
      numPOC/undergradEnrollment*100,
    
    numWhite = perc_White/100 * undergradEnrollment,
  #  SATReading75_10 = SATReading75/10, 
   # SATWriting75_10 = SATWriting75/10,
  #  SATMath75_10 = SATMath75/10
  )

cleanedDf <- cleanedDf %>%
  mutate(tuition1000Dollar = tuitionFees2013_14/1000,#Transform tuition into 1000's of dollars
         controlPublic = ifelse(control == 'Public', 1, 0), 
         HBCUYes = ifelse(HBCU == 'Yes', 1, 0)
         ) 
```

There are a lot of levels for degree of urbanization, so condensing them might be easier for interpretation and regression. 
```{r}
#condense the categories for degree of urbanization
cleanedDf <- cleanedDf %>%
  mutate(
    degreeUrbanization = ifelse(degreeUrbanization == 'City: Midsize'| degreeUrbanization == 'City: Small'| degreeUrbanization == 'City: Large', 'City', degreeUrbanization), 
    
    degreeUrbanization = ifelse(degreeUrbanization == 'Town: Fringe'|
                                  degreeUrbanization == 'Town: Distant'|
                                degreeUrbanization == 'Town: Remote', 'Town', degreeUrbanization), 
    
     degreeUrbanization = ifelse(degreeUrbanization == 'Rural: Remote'|
                                  degreeUrbanization == 'Rural: Fringe'|
                                degreeUrbanization == 'Rural: Distant', 'Rural', degreeUrbanization), 
    
    
    degreeUrbanization = ifelse(degreeUrbanization == 'Suburb: Large'|
                                  degreeUrbanization == 'Suburb: Small'|
                                degreeUrbanization == 'Suburb: Midsize', 'Suburb', degreeUrbanization)
  )
```

```{r}
cleanedDf <- cleanedDf %>%
  mutate(geographicRegion = str_extract(cleanedDf$geographicRegion,  "Far West|Southwest|Rocky Mountains|New England|Mid East|Great Lakes|Plains|Southeast") )
```

Converting  `geographicRegion` and `degreeUrbanization` into factors will be helpful for creating models with a reference group.

```{r}
#converting into factors
cleanedDf <-cleanedDf %>% 
  mutate(geographicRegion_factor = as_factor(geographicRegion), 
         degreeUrbanization_factor = as_factor(degreeUrbanization))

#get rid of US Service Schools
cleanedDf <- cleanedDf%>%
  filter(geographicRegion != 'US Service schools')
```

```{r}
#List all the rows with NA
cleanedDf[rowSums(is.na(cleanedDf)) > 0, ]
```

There are missings for variables that are used in the model. They indicate incompleteness, so dropping them makes sense here.

```{r}
#Deal with NA
library(dplyr)
cleanedDf <- anti_join(cleanedDf, cleanedDf[rowSums(is.na(cleanedDf)) > 0, ])
```

```{r}
write_csv(cleanedDf, "~/Stats 272 F22/Project/Group 7A: Swagat, Zoe, Maya/cleanedDf.csv")
```

# Main Plots, Models and Graphs

```{r}
collegeAdmission <- read_csv("~/Stats 272 F22/Project/Group 7A: Swagat, Zoe, Maya/cleanedDf.csv")
```

```{r}
collegeAdmission <- collegeAdmission %>% 
  mutate(high_diversity = ifelse(perc_POC > 20, 1, 0)) %>% 
  mutate(tuition10000 = tuitionFees2013_14/10000) %>% 
  mutate(diverse_yes = ifelse(high_diversity == 1, "YES", "NO"))
sum(collegeAdmission$high_diversity)


#center our quantitative variables
#collegeAdmission <- collegeAdmission %>%
 # mutate(tuition10000Centered = tuition10000 - mean(tuition10000),
   #      perc_FreshmenPellGrantsCentered = perc_FreshmenPellGrants - mean(perc_FreshmenPellGrants))

```

```{r, Figure 1}
#use this plot in main body
collegeAdmission %>%
  ggplot(mapping = aes(y = perc_POC, x = tuition1000Dollar, color = factor(control)))+ 
  geom_point(alpha = 0.5)+ 
  geom_smooth(method = 'lm', se = FALSE) +
  labs(x = "Tuition ($1000s)", y = "Percentage of Undergraduate Student Body POC (%)", color = "Instititional Control", caption = "Figure 1: Relationshipship between the percentage of POC students in undergraduate populations and tuition in thousands of dollars for private (red) and public (blue) institutions.")

## In this plot our lines of best fit are both at a downward angle meaning that as tuition increases the percentage of people of color at college and universities decreases for both public and private institutions. 

## Two different graphs or somehow plot on different scales 
```

```{r, Figure 2}
collegeAdmission %>%
  ggplot(aes(x = control, y = perc_POC))+ 
  geom_boxplot(varwidth = TRUE) +
  labs(x = "Institutional Control", y = "Percentage of Undergraduate Population POC (%)", color ="Institutional Control" , caption = "Figure 2: The mean percentage of POC students in the undergraduate population for institutions which are Private and Publically controlled universities. ")

# This boxplot demonstrates HBCUs have a much higher mean percentage of undergrduate students of color, then do non HBCUs. 
```

```{r, Figure 3}
## include in main body
collegeAdmission %>%
  ggplot(mapping = aes(y = perc_POC, x = geographicRegion))+ 
  geom_boxplot() +
  labs(x = "Geographic Region", y = "Percentage of Undergraduate Student Body POC (%)", color = "Geographic Region", caption = "Figure 3: The mean percentages of POC students in udergraduate population for US institutions in each geographic region.")

# This boxplot tells us the percentage of undergraduate students of color at colleges and universities by geographic region. As you can see below, the Far West and Southwest have the highest populations for undergraduate students of color.  
```

         
```{r}
#Using geographic Region
model1 <- lm(perc_POC ~ tuition1000Dollar + controlPublic + geographicRegion_factor, data = collegeAdmission2)
summary(model1)

resid_panel(model1)


#using degree of urbanization
model2 <- lm(perc_POC ~ tuition1000Dollar + controlPublic + degreeUrbanization_factor, data = collegeAdmission2)
summary(model2) #Not a good model

#geographicRegion and FreshmenPellGrants
model3 <- lm(perc_POC ~ tuition1000Dollar + controlPublic + geographicRegion_factor + perc_FreshmenPellGrants, data = collegeAdmission2)
summary(model3)
resid_panel(model3)

#geographicRegion, FreshmenPellGrants, and percentage of women 
model4 <- lm(perc_POC ~ tuition1000Dollar + controlPublic + geographicRegion_factor + perc_FreshmenPellGrants + perc_Women, data = collegeAdmission2)
summary(model4)
resid_panel(model4)

anova(model3, model4) #percentage of women significant

#geographicRegion, degreeofUrbanization and FreshmenPellGrants
model3.1 <-lm(perc_POC ~ tuition1000Dollar + controlPublic + geographicRegion_factor +degreeUrbanization+ perc_FreshmenPellGrants, data = collegeAdmission2) 
summary(model3.1) #.6654

anova(model3, model3.1) #degree of urbanization significant

#geographicRegion, FreshmenPellGrants, degree of Urbanization, and percentage of women 
model4.1 <-lm(perc_POC ~ tuition1000Dollar + controlPublic + geographicRegion_factor +degreeUrbanization+ perc_FreshmenPellGrants + perc_Women, data = collegeAdmission2) 
summary(model4.1) #.6652


anova(model3.1, model4.1) #percentage of women not significant

```


```{r, "Percentage POC"}
favstats(~perc_POC, data = collegeAdmission)
ggplot(collegeAdmission, aes(x = perc_POC)) +
  geom_histogram(bins = 30)

## Across all institutions included, the student bodies have a mean of 25.77% POC with a standard deviation of 19.3. The histogram shows that there is a skew right as some institutions have a high percentage of the population POC. 
```

```{r, "Tuition"}
favstats(~tuition1000Dollar, data = collegeAdmission)
ggplot(collegeAdmission, aes(x = tuition1000Dollar)) +
  geom_histogram(bins = 30)

## The mean tuition amount for all colleges included is 23.33 thousand dollars with a standard deviation of 12.83. This and the lack of a normality in the histogram indicate that tuition is highly variable among all the included colleges. 
```

```{r, "Freshman Recieving Financial Aid"}
favstats(~freshmenFinAidPercent, data = collegeAdmission)
ggplot(collegeAdmission, aes(x = freshmenFinAidPercent)) +
  geom_histogram(bins = 30)

## The mean percentage of students receiving financial aid is 89.73% with 12.58% standard deviation. The histogram is heavily skewed left, so it is apparent most institutions have freshmen receiving some form of financial aid. This tells us we may need to be more specific in the type of financial aid. 
```

```{r, Control}
table(collegeAdmission$control)
addmargins(table(collegeAdmission$control))
prop.table(table(collegeAdmission$control))
```

## Logistic Regression 
```{r}
model5 <- glm(high_diversity ~ HBCU + tuition10000 + controlPublic + geographicRegion_factor + perc_FreshmenPellGrants + degreeUrbanization_factor, family = binomial(link="logit"),data = collegeAdmission)
summary(model5)
#use tuition10000

model6 <- glm(high_diversity ~ HBCU + controlPublic +  geographicRegion_factor + perc_FreshmenPellGrants + degreeUrbanization_factor, family = binomial(link="logit"), data = collegeAdmission)
summary(model6) #without tuition

anova(model5, model6, test = "Chisq")

emplogitplot1(high_diversity ~ tuition10000, data = collegeAdmission, ngroups = 10)

emplogitplot1(high_diversity ~ perc_FreshmenPellGrants, data = collegeAdmission, ngroups = 10)
```


```{r}
ggplot(data = collegeAdmission, aes(x = perc_FreshmenPellGrants, fill = diverse_yes))+
  geom_density(position = 'fill', alpha = 0.5)

ggplot(data = collegeAdmission, aes(x = tuition10000, fill = diverse_yes))+
  geom_density(position = 'fill', alpha = 0.5)

public <- collegeAdmission %>% 
  filter(controlPublic == 1)

ggplot(data = public, aes(x = tuition10000, fill = diverse_yes))+
  geom_density(position = 'fill', alpha = 0.5)

private <- collegeAdmission %>% 
  filter(controlPublic == 0)

ggplot(data = private, aes(x = tuition10000, fill = diverse_yes))+
  geom_density(position = 'fill', alpha = 0.5)
#diversity for private institutions does not vary much based on tuition

## Pell Grants show linearity for both public and private schools in density plots 
```

```{r} 
#without HBCU
collegeAdmission2 <- collegeAdmission %>% 
  filter(HBCUYes == 0)

model7 <- glm(high_diversity ~ tuition10000 + controlPublic + geographicRegion_factor + perc_FreshmenPellGrants + degreeUrbanization_factor, family = binomial(link="logit"),data = collegeAdmission2)
summary(model7)
exp(model7$coefficients)
```


```{r}
#graphs for urbanization and geographic region (Without HBCU)
emplogitplot1(high_diversity ~ tuition10000 , data = collegeAdmission2, ngroups = 10)
emplogitplot1(high_diversity ~ perc_FreshmenPellGrants , data = collegeAdmission2, ngroups = 10)

```

```{r}
#model with just tuition and pell grants
modelTuition_PellGrants = glm(high_diversity ~ tuition10000 + perc_FreshmenPellGrants, family = binomial(link="logit"), data = collegeAdmission2)
summary(modelTuition_PellGrants)

#just Pell Grants
modelPellGrants = glm(high_diversity ~ perc_FreshmenPellGrants, family = binomial(link="logit"), data = collegeAdmission2)
summary(modelPellGrants)

#just Tuition
modelTuition = glm(high_diversity ~ tuition10000, family = binomial(link="logit"), data = collegeAdmission2)
summary(modelTuition)

anova(modelPellGrants, modelTuition_PellGrants, test = "Chisq") 
```

```{r}
#prediction for probability curve 

predict_atTuition <- tibble(tuition10000 = seq(from = 0.27, to = 5, length = 1000))

predict_atPellGrant <- tibble(perc_FreshmenPellGrants = seq(from = 0, to = 100, length = 1000))


prob_highdiversity <- unname(predict(modelPellGrants, new = predict_atPellGrant, type="response")) #for Pell grants

prob_highdiversity2 <- unname(predict(modelTuition, new = predict_atTuition, type="response")) # for Tuition

modeled_p <- tibble(predict_atPellGrant, prob_highdiversity = prob_highdiversity)
modeled_p2 <- tibble(predict_atTuition, prob_highdiversity = prob_highdiversity2)
```

```{r}
#probability curve for pell grants
ggplot() +
geom_point(data = collegeAdmission2, aes(x = perc_FreshmenPellGrants, y = high_diversity), alpha = 0.2) +
geom_line(data = modeled_p, aes(x = perc_FreshmenPellGrants, y = prob_highdiversity), color="red") +
ylab("P(Diverse)")
```

```{r}
#probability curve for Tuition
ggplot() +
geom_point(data = collegeAdmission2, aes(x = tuition10000, y = high_diversity), alpha = 0.2) +
geom_line(data = modeled_p2, aes(x = tuition10000, y = prob_highdiversity), color="red") +
ylab("P(Diverse)")
```

```{r}
## To assess model 7
collegeAdmission_predict <- collegeAdmission2 %>%
  mutate(predict_prob = predict(model7, type = "response"))

#threshold of 0.5
collegeAdmission_predict <- collegeAdmission_predict %>%
  mutate(predictYN = ifelse(predict_prob > .5, "Predict Diverse", 
                            "Predict Non Diverse"),
         actualYN = ifelse(high_diversity == 1, "Actual Diverse", "Actual Non Diverse"))
```

```{r}
#Confusion Table
confuse <- table(collegeAdmission_predict$actualYN, collegeAdmission_predict$predictYN)
confuse
addmargins(confuse)

# Calculate overall success rate of predictions
sum(diag(confuse)) / sum(confuse)   # 1118/1491
```

```{r}
#Sensitivity 
collegeAdmission_predict %>%
  filter(diverse_yes == "YES") %>%
  summarize(predict_diverse = sum(predictYN == "Predict Diverse"),
            total_diverse = n(),
            sensitivity = predict_diverse / total_diverse)

#Specificity
collegeAdmission_predict %>%
  filter(diverse_yes == "NO") %>%
  summarize(predict_nondiverse = sum(predictYN == "Predict Non Diverse"),
            total_nondiverse = n(),
            specificity = predict_nondiverse / total_nondiverse)
```

```{r}
#ROC Curve
ROC_pred <- prediction(prediction = collegeAdmission_predict$predict_prob, 
                   labels = collegeAdmission_predict$diverse_yes) 
perf <- performance(ROC_pred, measure = "tpr", x.measure = "fpr" ) 
plot(perf, colorize = T)
```

```{r}
#C-Statistic
auc <- as.numeric(performance(prediction = ROC_pred, measure = "auc")@y.values)
auc
```


# Article Citations (APA)

Bennett, C., Evans, B., & Marsicano, C. (2021). Taken for Granted? Effects of Loan-Reduction Initiatives on Student Borrowing, Admission Metrics, and Campus Diversity. Research in Higher Education, 62(5), 569–599. https://doi.org/10.1007/s11162-020-09615-7

Hurtado, S., Inkelas, K. K., Briggs, C., & Rhee, B.-S. (1997). Differences in College Access and Choice Among Racial/Ethnic Groups: Identifying Continuing Barriers. Research in Higher Education, 38(1), 43–75. https://doi.org/10.1023/A:1024948728792